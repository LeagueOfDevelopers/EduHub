webpackJsonp([8],{"./app/components/Chat/index.js":function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e){return{sendMessage:function(t,n){return e(Object(v._10)(t,n))},getCurrentChat:function(t){return e(Object(v.R)(t))},getMessage:function(t){return e(Object(v.X)(t))}}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var d=n("./node_modules/react/react.js"),h=n.n(d),m=n("./node_modules/react-dom/index.js"),g=n.n(m),y=(n("./node_modules/prop-types/index.js"),n("./node_modules/reselect/es/index.js")),b=n("./node_modules/react-redux/es/index.js"),v=n("./app/containers/GroupPage/actions.js"),w=n("./app/globalJS.js"),O=n("./node_modules/antd/lib/index.js"),I=function(){var e="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(t,n,o,r){var s=t&&t.defaultProps,i=arguments.length-3;if(n||0===i||(n={}),n&&s)for(var a in s)void 0===n[a]&&(n[a]=s[a]);else n||(n=s||{});if(1===i)n.children=r;else if(i>1){for(var u=Array(i),l=0;l<i;l++)u[l]=arguments[l+3];n.children=u}return{$$typeof:e,type:t,key:void 0===o?null:""+o,ref:null,props:n,_owner:null}}}(),S=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),j=function(e){function t(e){return o(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return s(t,e),S(t,[{key:"render",value:function(){return this.props.message?I("li",{className:"message "+(Object(w.l)(localStorage.getItem("token")).UserId==this.props.message.senderId?"right":"left")},void 0,Object(w.l)(localStorage.getItem("token")).UserId!=this.props.message.senderId&&I("span",{style:{opacity:.8}},void 0,this.props.message.senderName),I("p",{style:{margin:"6px 0"}},void 0,this.props.message.text),I("div",{style:{textAlign:"left",fontSize:12,opacity:.5,marginBottom:6}},void 0,(new Date(this.props.message.sentOn).getHours()<10?"0"+new Date(this.props.message.sentOn).getHours():new Date(this.props.message.sentOn).getHours())+":"+(new Date(this.props.message.sentOn).getMinutes()<10?"0"+new Date(this.props.message.sentOn).getMinutes():new Date(this.props.message.sentOn).getMinutes()))):null}}]),t}(h.a.Component),_=j,k=function(){var e="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(t,n,o,r){var s=t&&t.defaultProps,i=arguments.length-3;if(n||0===i||(n={}),n&&s)for(var a in s)void 0===n[a]&&(n[a]=s[a]);else n||(n=s||{});if(1===i)n.children=r;else if(i>1){for(var u=Array(i),l=0;l<i;l++)u[l]=arguments[l+3];n.children=u}return{$$typeof:e,type:t,key:void 0===o?null:""+o,ref:null,props:n,_owner:null}}}(),M=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),x=k("div",{className:"header"},void 0,"Чат"),D=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),o="ws://85.143.104.47:2411/api/sockets/creation?token="+localStorage.getItem("token");return localStorage.getItem("token")&&(n.socket=new WebSocket(o)),n.state={messages:[],showIsInGroupError:!1},n}return u(t,e),M(t,[{key:"componentDidMount",value:function(){localStorage.getItem("token")&&this.connectSocket(this.socket),this.scrollToBottom()}},{key:"connectSocket",value:function(e){var t=this;e.onopen=function(e){console.log("opened connection")},e.onclose=function(e){console.log("closed connection")},e.onmessage=function(e){var n=JSON.parse(e.data);console.log("message received "+JSON.stringify(n)),t.props.getMessage({id:n.Id,senderId:n.SenderId,senderName:n.SenderName,sentOn:n.SentOn,text:n.Text})},e.onerror=function(e){console.log("error "+JSON.stringify(e))}}},{key:"componentDidUpdate",value:function(e,t){(e.chat&&this.props.chat&&e.chat.length!==this.props.chat.length||!e.chat&&this.props.chat)&&this.scrollToBottom(),e.isInGroup!==this.props.isInGroup&&this.props.isInGroup&&this.setState({showIsInGroupError:!1})}},{key:"componentWillUnmount",value:function(){localStorage.getItem("token")&&this.socket.close()}},{key:"scrollToBottom",value:function(){g.a.findDOMNode(this.chat).scrollTop=g.a.findDOMNode(this.chat).scrollHeight}},{key:"submitMessage",value:function(e){e&&e.preventDefault(),this.props.isInGroup?this.setState({showIsInGroupError:!1}):this.setState({showIsInGroupError:!0}),""!==g.a.findDOMNode(this.msgInput).value&&this.props.isInGroup&&("true"===localStorage.getItem("withoutServer")?this.setState({messages:this.state.messages.concat([{id:Math.random(),username:localStorage.getItem("name"),text:g.a.findDOMNode(this.msgInput).value,time:(new Date).getHours()+":"+((new Date).getMinutes()<10?"0":"")+(new Date).getMinutes()}])}):this.props.sendMessage(this.props.groupId,g.a.findDOMNode(this.msgInput).value)),g.a.findDOMNode(this.msgInput).value="",g.a.findDOMNode(this.msgInput).focus()}},{key:"render",value:function(){var e=this;return k("div",{},void 0,k("div",{className:"chatroom"},void 0,x,k("div",{style:{overflowX:"hidden"}},void 0,h.a.createElement("ul",{className:"chat",ref:function(t){return e.chat=t}},"true"===localStorage.getItem("withoutServer")?this.state.messages.map(function(e){return k(_,{message:e,user:localStorage.getItem("name")},e.id)}):this.props.chat?this.props.chat.map(function(e,t){return k(_,{message:e},e.id?e.id:Math.random())}):[].map(function(e,t){return k(_,{},t)})),k("form",{className:"input",onSubmit:function(t){return e.submitMessage(t)}},void 0,k(O.Row,{type:"flex"},void 0,k(O.Col,{style:{width:"calc(100% - 44px)"}},void 0,h.a.createElement(O.Input,{size:"large",style:{width:"100%"},ref:function(t){return e.msgInput=t},placeholder:"Введите сообщение"})),k(O.Col,{style:{display:"flex",height:40,alignItems:"center",justifyContent:"flex-end",minWidth:24,marginRight:20}},void 0,k("img",{src:n("./app/images/send-darkblue.svg"),onClick:function(){return e.submitMessage()},className:"send-msg-btn"})))))),this.state.showIsInGroupError?k("div",{style:{color:"red",marginTop:4}},void 0,"Вы должны вступить в группу"):"")}}]),t}(h.a.Component),N=Object(y.b)({}),E=Object(b.b)(N,l)(D),P=function(){var e="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(t,n,o,r){var s=t&&t.defaultProps,i=arguments.length-3;if(n||0===i||(n={}),n&&s)for(var a in s)void 0===n[a]&&(n[a]=s[a]);else n||(n=s||{});if(1===i)n.children=r;else if(i>1){for(var u=Array(i),l=0;l<i;l++)u[l]=arguments[l+3];n.children=u}return{$$typeof:e,type:t,key:void 0===o?null:""+o,ref:null,props:n,_owner:null}}}(),C=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),T=function(e){function t(){return c(this,t),p(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return f(t,e),C(t,[{key:"render",value:function(){return P("div",{},void 0,h.a.createElement(E,this.props))}}]),t}(h.a.Component);t.default=T},"./app/images/send-darkblue.svg":function(e,t,n){e.exports=n.p+"48cf81bfb7b171f1d4e9a97b4f230b3b.svg"}});