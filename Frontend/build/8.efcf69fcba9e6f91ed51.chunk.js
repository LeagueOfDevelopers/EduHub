webpackJsonp([8],{"./app/components/Chat/index.js":function(e,t,o){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function c(e){return{sendMessage:function(t,o){return e(Object(v._10)(t,o))},getCurrentChat:function(t){return e(Object(v.R)(t))},getMessage:function(t){return e(Object(v.X)(t))}}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var m=o("./node_modules/react/react.js"),d=o.n(m),h=o("./node_modules/react-dom/index.js"),g=o.n(h),y=(o("./node_modules/prop-types/index.js"),o("./node_modules/reselect/es/index.js")),b=o("./node_modules/react-redux/es/index.js"),v=o("./app/containers/GroupPage/actions.js"),O=o("./app/globalJS.js"),w=o("./node_modules/antd/lib/index.js"),T=function(){var e="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(t,o,n,r){var s=t&&t.defaultProps,i=arguments.length-3;if(o||0===i||(o={}),o&&s)for(var a in s)void 0===o[a]&&(o[a]=s[a]);else o||(o=s||{});if(1===i)o.children=r;else if(i>1){for(var p=Array(i),c=0;c<i;c++)p[c]=arguments[c+3];o.children=p}return{$$typeof:e,type:t,key:void 0===n?null:""+n,ref:null,props:o,_owner:null}}}(),S=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),k=function(e){function t(e){return n(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return s(t,e),S(t,[{key:"render",value:function(){var e=this,t=this.props.message.notificationType?JSON.parse(this.props.message.notificationInfo):null;return this.props.message?this.props.message.notificationType?T("li",{className:"message notify"},void 0,T("span",{},void 0,1===this.props.message.notificationType?"Преподаватель "+t.TeacherName+' завершил курс в группе "'+t.GroupTitle+'"':2===this.props.message.notificationType?'Учебный план группы "'+t.GroupTitle+'" принят':3===this.props.message.notificationType?"Пользователь "+t.DeclinedName+' отклонил учебный план группы "'+t.GroupTitle+'"':4===this.props.message.notificationType?T("div",{},void 0,T("span",{style:{display:"block"}},void 0,"В группе ",t.GroupTitle," предложен учебный план"),T("a",{target:"_blank",onClick:function(){return e.props.downloadCourseFile(t.CurriculumLink)}},void 0,"Скачать учебный план")):5===this.props.message.notificationType?'Группа "'+t.GroupTitle+'" сформирована':6===this.props.message.notificationType?"Пользователь "+t.InvitedName+' принял ваше приглашение в группу "'+t.GroupTitle+'"':7===this.props.message.notificationType?"Пользователь "+t.InvitedName+' отклонил ваше приглашение в группу "'+t.GroupTitle+'"':8===this.props.message.notificationType?"Пользователь "+t.InviterName+' пригласил вас в группу "'+t.GroupTitle+'" на роль "'+Object(O.g)(t.SuggestedRole)+'"':9===this.props.message.notificationType?"Пользователь "+t.Username+' покинул группу "'+t.GroupTitle+'"':10===this.props.message.notificationType?"Пользователь "+t.NewCreatorUsername+' стал новым создателем группы "'+t.GroupTitle+'"':11===this.props.message.notificationType?"Пользователь "+t.Username+' присоединился в группу "'+t.GroupTitle+'"':12===this.props.message.notificationType?"Пользователь "+t.SenderName+" отправил репорт на пользователя "+t.SuspectedName+' за нарушение правила "'+t.BrokenRule+'"':13===this.props.message.notificationType?"Пользователь "+t.ReviewerName+' оставил отзыв о преподавателе группы "'+t.GroupTitle+'"':14===this.props.message.notificationType?'К вам была применена санкция "'+Object(O.k)(t.SanctionType)+'" за нарушение правила "'+t.BrokenRule+'"':15===this.props.message.notificationType?"К пользователю "+t.Username+' была применена санкция "'+Object(O.k)(t.SanctionType)+'" за нарушение правила "'+t.BrokenRule+'"':16===this.props.message.notificationType?"Пользователь "+t.TeacherName+' стал новым учителем группы "'+t.GroupTitle+'"':17===this.props.message.notificationType?'Примененная к вам санкция "'+Object(O.k)(t.SanctionType)+'" за нарушение правила "'+t.BrokenRule+'" была отменена':18===this.props.message.notificationType?"Примененная к пользователю "+t.Username+' санкция "'+Object(O.k)(t.SanctionType)+'" за нарушение правила "'+t.BrokenRule+'" была отменена':"")):T("li",{className:"message "+(Object(O.l)(localStorage.getItem("token")).UserId==this.props.message.senderId?"right":"left")},void 0,Object(O.l)(localStorage.getItem("token")).UserId!=this.props.message.senderId&&T("span",{style:{opacity:.8}},void 0,this.props.message.senderName),T("p",{style:{margin:"6px 0"}},void 0,this.props.message.text),T("div",{style:{textAlign:"left",fontSize:12,opacity:.5,marginBottom:6}},void 0,(new Date(this.props.message.sentOn).getHours()<10?"0"+new Date(this.props.message.sentOn).getHours():new Date(this.props.message.sentOn).getHours())+":"+(new Date(this.props.message.sentOn).getMinutes()<10?"0"+new Date(this.props.message.sentOn).getMinutes():new Date(this.props.message.sentOn).getMinutes()))):null}}]),t}(d.a.Component),I=k,j=function(){var e="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(t,o,n,r){var s=t&&t.defaultProps,i=arguments.length-3;if(o||0===i||(o={}),o&&s)for(var a in s)void 0===o[a]&&(o[a]=s[a]);else o||(o=s||{});if(1===i)o.children=r;else if(i>1){for(var p=Array(i),c=0;c<i;c++)p[c]=arguments[c+3];o.children=p}return{$$typeof:e,type:t,key:void 0===n?null:""+n,ref:null,props:o,_owner:null}}}(),_=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),N=j("div",{className:"header"},void 0,"Чат"),G=function(e){function t(e){i(this,t);var o=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),n="ws://85.143.104.47:2411/api/sockets/creation?token="+localStorage.getItem("token");return localStorage.getItem("token")&&(o.socket=new WebSocket(n)),o.state={messages:[],showIsInGroupError:!1},o}return p(t,e),_(t,[{key:"componentDidMount",value:function(){localStorage.getItem("token")&&this.connectSocket(this.socket),this.scrollToBottom()}},{key:"connectSocket",value:function(e){var t=this;e.onopen=function(e){console.log("opened connection")},e.onclose=function(e){console.log("closed connection")},e.onmessage=function(e){var o=JSON.parse(e.data);console.log("message received "+JSON.stringify(o)),t.props.getMessage({id:o.Id,senderId:o.SenderId,senderName:o.SenderName,sentOn:o.SentOn,text:o.Text})},e.onerror=function(e){console.log("error "+JSON.stringify(e))}}},{key:"componentDidUpdate",value:function(e,t){(e.chat&&this.props.chat&&e.chat.length!==this.props.chat.length||!e.chat&&this.props.chat)&&this.scrollToBottom(),e.isInGroup!==this.props.isInGroup&&this.props.isInGroup&&this.setState({showIsInGroupError:!1})}},{key:"componentWillUnmount",value:function(){localStorage.getItem("token")&&this.socket.close()}},{key:"scrollToBottom",value:function(){g.a.findDOMNode(this.chat).scrollTop=g.a.findDOMNode(this.chat).scrollHeight}},{key:"submitMessage",value:function(e){e&&e.preventDefault(),this.props.isInGroup?this.setState({showIsInGroupError:!1}):this.setState({showIsInGroupError:!0}),""!==g.a.findDOMNode(this.msgInput).value&&this.props.isInGroup&&("true"===localStorage.getItem("withoutServer")?this.setState({messages:this.state.messages.concat([{id:Math.random(),username:localStorage.getItem("name"),text:g.a.findDOMNode(this.msgInput).value,time:(new Date).getHours()+":"+((new Date).getMinutes()<10?"0":"")+(new Date).getMinutes()}])}):this.props.sendMessage(this.props.groupId,g.a.findDOMNode(this.msgInput).value)),g.a.findDOMNode(this.msgInput).value="",g.a.findDOMNode(this.msgInput).focus()}},{key:"render",value:function(){var e=this;return j("div",{},void 0,j("div",{className:"chatroom"},void 0,N,j("div",{style:{overflowX:"hidden"}},void 0,d.a.createElement("ul",{className:"chat",ref:function(t){return e.chat=t}},"true"===localStorage.getItem("withoutServer")?this.state.messages.map(function(e){return j(I,{message:e,user:localStorage.getItem("name")},e.notificationType?"notify-"+e.id:"msg-"+e.id)}):this.props.chat?this.props.chat.map(function(e,t){return j(I,{message:e},e.id?e.notificationType?"notify-"+e.id:"msg-"+e.id:Math.random())}):[].map(function(e,t){return j(I,{},t)})),j("form",{className:"input",onSubmit:function(t){return e.submitMessage(t)}},void 0,j(w.Row,{type:"flex"},void 0,j(w.Col,{style:{width:"calc(100% - 44px)"}},void 0,d.a.createElement(w.Input,{size:"large",style:{width:"100%"},ref:function(t){return e.msgInput=t},placeholder:"Введите сообщение"})),j(w.Col,{style:{display:"flex",height:40,alignItems:"center",justifyContent:"flex-end",minWidth:24,marginRight:20}},void 0,j("img",{src:o("./app/images/send-darkblue.svg"),onClick:function(){return e.submitMessage()},className:"send-msg-btn"})))))),this.state.showIsInGroupError?j("div",{style:{color:"red",marginTop:4}},void 0,"Вы должны вступить в группу"):"")}}]),t}(d.a.Component),M=Object(y.b)({}),x=Object(b.b)(M,c)(G),D=function(){var e="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(t,o,n,r){var s=t&&t.defaultProps,i=arguments.length-3;if(o||0===i||(o={}),o&&s)for(var a in s)void 0===o[a]&&(o[a]=s[a]);else o||(o=s||{});if(1===i)o.children=r;else if(i>1){for(var p=Array(i),c=0;c<i;c++)p[c]=arguments[c+3];o.children=p}return{$$typeof:e,type:t,key:void 0===n?null:""+n,ref:null,props:o,_owner:null}}}(),C=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),E=function(e){function t(){return l(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return f(t,e),C(t,[{key:"render",value:function(){return D("div",{},void 0,d.a.createElement(x,this.props))}}]),t}(d.a.Component);t.default=E},"./app/images/send-darkblue.svg":function(e,t,o){e.exports=o.p+"48cf81bfb7b171f1d4e9a97b4f230b3b.svg"}});