webpackJsonp([8],{"./app/components/Chat/index.js":function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function c(e){return{sendMessage:function(t,n){return e(Object(v._10)(t,n))},getCurrentChat:function(t){return e(Object(v.R)(t))},getMessage:function(t){return e(Object(v.X)(t))}}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var m=n("./node_modules/react/react.js"),h=n.n(m),d=n("./node_modules/react-dom/index.js"),g=n.n(d),y=(n("./node_modules/prop-types/index.js"),n("./node_modules/reselect/es/index.js")),b=n("./node_modules/react-redux/es/index.js"),v=n("./app/containers/GroupPage/actions.js"),O=n("./app/globalJS.js"),w=n("./node_modules/antd/lib/index.js"),S=function(){var e="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(t,n,o,s){var r=t&&t.defaultProps,i=arguments.length-3;if(n||0===i||(n={}),n&&r)for(var a in r)void 0===n[a]&&(n[a]=r[a]);else n||(n=r||{});if(1===i)n.children=s;else if(i>1){for(var p=Array(i),c=0;c<i;c++)p[c]=arguments[c+3];n.children=p}return{$$typeof:e,type:t,key:void 0===o?null:""+o,ref:null,props:n,_owner:null}}}(),I=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),k=function(e){function t(e){return o(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return r(t,e),I(t,[{key:"render",value:function(){var e=this.props.message.notificationType?JSON.parse(this.props.message.notificationInfo):null;return this.props.message?this.props.message.notificationType?S("li",{className:"message notify"},void 0,S("span",{},void 0,1===this.props.message.notificationType?"Преподаватель "+e.TeacherName+" завершил курс":2===this.props.message.notificationType?"Учебный план группы принят":3===this.props.message.notificationType?"Пользователь "+e.DeclinedName+" отклонил учебный план":4===this.props.message.notificationType?"В группе предложен учебный план":5===this.props.message.notificationType?"Группа сформирована":6===this.props.message.notificationType?"Пользователь "+e.InvitedName+" принял ваше приглашение":7===this.props.message.notificationType?"Пользователь "+e.InvitedName+" отклонил ваше приглашение":8===this.props.message.notificationType?"Пользователь "+e.InviterName+' пригласил вас в группу "'+e.GroupTitle+'" на роль "'+Object(O.g)(e.SuggestedRole)+'"':9===this.props.message.notificationType?"Пользователь "+e.Username+" покинул группу":10===this.props.message.notificationType?"Пользователь "+e.NewCreatorUsername+" стал новым создателем группы":11===this.props.message.notificationType?"Пользователь "+e.Username+" присоединился в группу":12===this.props.message.notificationType?"Пользователь "+e.SenderName+" отправил репорт на пользователя "+e.SuspectedName+' за нарушение правила "'+e.BrokenRule+'"':13===this.props.message.notificationType?"Пользователь "+e.ReviewerName+" оставил отзыв о преподавателе группы":14===this.props.message.notificationType?'К вам была применена санкция "'+Object(O.k)(e.SanctionType)+'" за нарушение правила "'+e.BrokenRule+'"':15===this.props.message.notificationType?"К пользователю "+e.Username+' была применена санкция "'+Object(O.k)(e.SanctionType)+'" за нарушение правила "'+e.BrokenRule+'"':16===this.props.message.notificationType?"Пользователь "+e.TeacherName+" стал новым учителем группы":17===this.props.message.notificationType?'Примененная к вам санкция "'+Object(O.k)(e.SanctionType)+'" за нарушение правила "'+e.BrokenRule+'" была отменена':18===this.props.message.notificationType?"Примененная к пользователю "+e.Username+' санкция "'+Object(O.k)(e.SanctionType)+'" за нарушение правила "'+e.BrokenRule+'" была отменена':"")):S("li",{className:"message "+(Object(O.l)(localStorage.getItem("token")).UserId==this.props.message.senderId?"right":"left")},void 0,Object(O.l)(localStorage.getItem("token")).UserId!=this.props.message.senderId&&S("span",{style:{opacity:.8}},void 0,this.props.message.senderName),S("p",{style:{margin:"6px 0"}},void 0,this.props.message.text),S("div",{style:{textAlign:"left",fontSize:12,opacity:.5,marginBottom:6}},void 0,(new Date(this.props.message.sentOn).getHours()<10?"0"+new Date(this.props.message.sentOn).getHours():new Date(this.props.message.sentOn).getHours())+":"+(new Date(this.props.message.sentOn).getMinutes()<10?"0"+new Date(this.props.message.sentOn).getMinutes():new Date(this.props.message.sentOn).getMinutes()))):null}}]),t}(h.a.Component),j=k,T=function(){var e="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(t,n,o,s){var r=t&&t.defaultProps,i=arguments.length-3;if(n||0===i||(n={}),n&&r)for(var a in r)void 0===n[a]&&(n[a]=r[a]);else n||(n=r||{});if(1===i)n.children=s;else if(i>1){for(var p=Array(i),c=0;c<i;c++)p[c]=arguments[c+3];n.children=p}return{$$typeof:e,type:t,key:void 0===o?null:""+o,ref:null,props:n,_owner:null}}}(),_=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),N=T("div",{className:"header"},void 0,"Чат"),M=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),o="ws://85.143.104.47:2411/api/sockets/creation?token="+localStorage.getItem("token");return localStorage.getItem("token")&&(n.socket=new WebSocket(o)),n.state={messages:[],showIsInGroupError:!1},n}return p(t,e),_(t,[{key:"componentDidMount",value:function(){localStorage.getItem("token")&&this.connectSocket(this.socket),this.scrollToBottom()}},{key:"connectSocket",value:function(e){var t=this;e.onopen=function(e){console.log("opened connection")},e.onclose=function(e){console.log("closed connection")},e.onmessage=function(e){var n=JSON.parse(e.data);console.log("message received "+JSON.stringify(n)),t.props.getMessage({id:n.Id,senderId:n.SenderId,senderName:n.SenderName,sentOn:n.SentOn,text:n.Text})},e.onerror=function(e){console.log("error "+JSON.stringify(e))}}},{key:"componentDidUpdate",value:function(e,t){(e.chat&&this.props.chat&&e.chat.length!==this.props.chat.length||!e.chat&&this.props.chat)&&this.scrollToBottom(),e.isInGroup!==this.props.isInGroup&&this.props.isInGroup&&this.setState({showIsInGroupError:!1})}},{key:"componentWillUnmount",value:function(){localStorage.getItem("token")&&this.socket.close()}},{key:"scrollToBottom",value:function(){g.a.findDOMNode(this.chat).scrollTop=g.a.findDOMNode(this.chat).scrollHeight}},{key:"submitMessage",value:function(e){e&&e.preventDefault(),this.props.isInGroup?this.setState({showIsInGroupError:!1}):this.setState({showIsInGroupError:!0}),""!==g.a.findDOMNode(this.msgInput).value&&this.props.isInGroup&&("true"===localStorage.getItem("withoutServer")?this.setState({messages:this.state.messages.concat([{id:Math.random(),username:localStorage.getItem("name"),text:g.a.findDOMNode(this.msgInput).value,time:(new Date).getHours()+":"+((new Date).getMinutes()<10?"0":"")+(new Date).getMinutes()}])}):this.props.sendMessage(this.props.groupId,g.a.findDOMNode(this.msgInput).value)),g.a.findDOMNode(this.msgInput).value="",g.a.findDOMNode(this.msgInput).focus()}},{key:"render",value:function(){var e=this;return T("div",{},void 0,T("div",{className:"chatroom"},void 0,N,T("div",{style:{overflowX:"hidden"}},void 0,h.a.createElement("ul",{className:"chat",ref:function(t){return e.chat=t}},"true"===localStorage.getItem("withoutServer")?this.state.messages.map(function(e){return T(j,{message:e,user:localStorage.getItem("name")},e.notificationType?"notify-"+e.id:"msg-"+e.id)}):this.props.chat?this.props.chat.map(function(e,t){return T(j,{message:e},e.id?e.notificationType?"notify-"+e.id:"msg-"+e.id:Math.random())}):[].map(function(e,t){return T(j,{},t)})),T("form",{className:"input",onSubmit:function(t){return e.submitMessage(t)}},void 0,T(w.Row,{type:"flex"},void 0,T(w.Col,{style:{width:"calc(100% - 44px)"}},void 0,h.a.createElement(w.Input,{size:"large",style:{width:"100%"},ref:function(t){return e.msgInput=t},placeholder:"Введите сообщение"})),T(w.Col,{style:{display:"flex",height:40,alignItems:"center",justifyContent:"flex-end",minWidth:24,marginRight:20}},void 0,T("img",{src:n("./app/images/send-darkblue.svg"),onClick:function(){return e.submitMessage()},className:"send-msg-btn"})))))),this.state.showIsInGroupError?T("div",{style:{color:"red",marginTop:4}},void 0,"Вы должны вступить в группу"):"")}}]),t}(h.a.Component),x=Object(y.b)({}),D=Object(b.b)(x,c)(M),E=function(){var e="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(t,n,o,s){var r=t&&t.defaultProps,i=arguments.length-3;if(n||0===i||(n={}),n&&r)for(var a in r)void 0===n[a]&&(n[a]=r[a]);else n||(n=r||{});if(1===i)n.children=s;else if(i>1){for(var p=Array(i),c=0;c<i;c++)p[c]=arguments[c+3];n.children=p}return{$$typeof:e,type:t,key:void 0===o?null:""+o,ref:null,props:n,_owner:null}}}(),P=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),C=function(e){function t(){return l(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return f(t,e),P(t,[{key:"render",value:function(){return E("div",{},void 0,h.a.createElement(D,this.props))}}]),t}(h.a.Component);t.default=C},"./app/images/send-darkblue.svg":function(e,t,n){e.exports=n.p+"48cf81bfb7b171f1d4e9a97b4f230b3b.svg"}});